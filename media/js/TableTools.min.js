var TableToolsInit={"oFeatures":{"bCsv":true,"bXls":true,"bCopy":true,"bPrint":true},"oBom":{"bCsv":true,"bXls":true},"bIncFooter":true,"bIncHiddenColumns":false,"sPrintMessage":"sgfsgsgfsd sdsgsgsdsdfgsdg","sPrintInfo":"<h6>Print view</h6><p>Please use your browser's print function to "+"print this table. Press escape when finished.","sTitle":"","sSwfPath":"media/swf/ZeroClipboard.swf","iButtonHeight":30,"iButtonWidth":30,"sCsvBoundary":"'","_iNextId":1};(function($){function TableTools(oInit){var _oSettings;var nTools=null;var _nTableWrapper;var _aoPrintHidden=[];var _iPrintScroll=0;var _nPrintMessage=null;var _DTSettings;var _sLastData;var _iId;function _fnInit(oInit){_nTools=document.createElement('div');_nTools.className="TableTools";_iId=TableToolsInit._iNextId++;_oSettings=$.extend(true,{},TableToolsInit);_DTSettings=oInit.oDTSettings;_nTableWrapper=fnFindParentClass(_DTSettings.nTable,"dataTables_wrapper");ZeroClipboard.moviePath=_oSettings.sSwfPath;if(_oSettings.oFeatures.bCopy){fnFeatureClipboard()}if(_oSettings.oFeatures.bCsv){fnFeatureSaveCSV()}if(_oSettings.oFeatures.bXls){fnFeatureSaveXLS()}if(_oSettings.oFeatures.bPrint){fnFeaturePrint()}return _nTools}function fnFeatureSaveCSV(){var sBaseClass="TableTools_button TableTools_csv";var nButton=document.createElement('div');nButton.id="ToolTables_CSV_"+_iId;nButton.style.height=_oSettings.iButtonHeight+'px';nButton.style.width=_oSettings.iButtonWidth+'px';nButton.className=sBaseClass;_nTools.appendChild(nButton);var clip=new ZeroClipboard.Client();clip.setHandCursor(true);clip.setAction('save');clip.setCharSet('UTF8');clip.setBomInc(_oSettings.oBom.bCsv);clip.setFileName(fnGetTitle()+'.csv');clip.addEventListener('mouseOver',function(client){nButton.className=sBaseClass+'_hover'});clip.addEventListener('mouseOut',function(client){nButton.className=sBaseClass});clip.addEventListener('mouseDown',function(client){fnFlashSetText(clip,fnGetDataTablesData(",",TableToolsInit.sCsvBoundary))});fnGlue(clip,nButton,"ToolTables_CSV_"+_iId,"Save as CSV")}function fnFeatureSaveXLS(){var sBaseClass="TableTools_button TableTools_xls";var nButton=document.createElement('div');nButton.id="ToolTables_XLS_"+_iId;nButton.style.height=_oSettings.iButtonHeight+'px';nButton.style.width=_oSettings.iButtonWidth+'px';nButton.className=sBaseClass;_nTools.appendChild(nButton);var clip=new ZeroClipboard.Client();clip.setHandCursor(true);clip.setAction('save');clip.setCharSet('UTF16LE');clip.setBomInc(_oSettings.oBom.bXls);clip.setFileName(fnGetTitle()+'.xls');clip.addEventListener('mouseOver',function(client){nButton.className=sBaseClass+'_hover'});clip.addEventListener('mouseOut',function(client){nButton.className=sBaseClass});clip.addEventListener('mouseDown',function(client){fnFlashSetText(clip,fnGetDataTablesData("\t"))});fnGlue(clip,nButton,"ToolTables_XLS_"+_iId,"Save for Excel")}function fnFeatureClipboard(){var sBaseClass="TableTools_button TableTools_clipboard";var nButton=document.createElement('div');nButton.id="ToolTables_Copy_"+_iId;nButton.style.height=_oSettings.iButtonHeight+'px';nButton.style.width=_oSettings.iButtonWidth+'px';nButton.className=sBaseClass;_nTools.appendChild(nButton);var clip=new ZeroClipboard.Client();clip.setHandCursor(true);clip.setAction('copy');clip.addEventListener('mouseOver',function(client){nButton.className=sBaseClass+'_hover'});clip.addEventListener('mouseOut',function(client){nButton.className=sBaseClass});clip.addEventListener('mouseDown',function(client){fnFlashSetText(clip,fnGetDataTablesData("\t"))});clip.addEventListener('complete',function(client,text){var aData=_sLastData.split('\n');alert('Copied '+(aData.length-1)+' rows to the clipboard')});fnGlue(clip,nButton,"ToolTables_Copy_"+_iId,"Copy to clipboard")}function fnFeaturePrint(){var sBaseClass="TableTools_button TableTools_print";var nButton=document.createElement('div');nButton.style.height=_oSettings.iButtonHeight+'px';nButton.style.width=_oSettings.iButtonWidth+'px';nButton.className=sBaseClass;nButton.title="Print table";_nTools.appendChild(nButton);$(nButton).hover(function(client){nButton.className=sBaseClass+'_hover'},function(client){nButton.className=sBaseClass});$(nButton).click(function(){fnPrintHideNodes(_DTSettings.nTable);_iPrintSaveStart=_DTSettings._iDisplayStart;_iPrintSaveLength=_DTSettings._iDisplayLength;_DTSettings._iDisplayStart=0;_DTSettings._iDisplayLength=-1;_DTSettings.oApi._fnCalculateEnd(_DTSettings);_DTSettings.oApi._fnDraw(_DTSettings);var anFeature=_DTSettings.anFeatures;for(var cFeature in anFeature){if(cFeature!='i'&&cFeature!='t'){_aoPrintHidden.push({"node":anFeature[cFeature],"display":"block"});anFeature[cFeature].style.display="none"}}var nInfo=document.createElement("div");nInfo.className="TableTools_PrintInfo";nInfo.innerHTML=_oSettings.sPrintInfo;document.body.appendChild(nInfo);if(_oSettings.sPrintMessage!==""){_nPrintMessage=document.createElement("p");_nPrintMessage.className="TableTools_PrintMessage";_nPrintMessage.innerHTML=_oSettings.sPrintMessage;document.body.insertBefore(_nPrintMessage,document.body.childNodes[0])}_iPrintScroll=$(window).scrollTop();window.scrollTo(0,0);$(document).bind("keyup",null,fnPrintEnd);setTimeout(function(){$(nInfo).fadeOut("normal",function(){document.body.removeChild(nInfo);self.print()})},2000);$('.dataTables_scrollBody').addClass('noScrollY');$('.gridTitle,.gridHide').css('display','none');$('.dataTables_scrollHead, .dataTables_scrollFoot').css('display','table-header-group');$('.dataTables_scrollHeadInner, .dataTables_scrollFootInner').css('width','auto')})}function fnPrintEnd(e){if(e.keyCode==27){fnPrintShowNodes();window.scrollTo(0,_iPrintScroll);if(_nPrintMessage){document.body.removeChild(_nPrintMessage);_nPrintMessage=null}_DTSettings._iDisplayStart=_iPrintSaveStart;_DTSettings._iDisplayLength=_iPrintSaveLength;_DTSettings.oApi._fnCalculateEnd(_DTSettings);_DTSettings.oApi._fnDraw(_DTSettings);$(document).unbind("keydown",fnPrintEnd);$('.dataTables_scrollBody').removeClass('noScrollY');$('.gridTitle,.gridHide').css('display','table-cell')}}function fnPrintShowNodes(){for(var i=0,iLen=_aoPrintHidden.length;i<iLen;i++){_aoPrintHidden[i].node.style.display=_aoPrintHidden[i].display}_aoPrintHidden.splice(0,_aoPrintHidden.length)}function fnPrintHideNodes(nNode){var nParent=nNode.parentNode;var nChildren=nParent.childNodes;for(var i=0,iLen=nChildren.length;i<iLen;i++){if(nChildren[i]!=nNode&&nChildren[i].nodeType==1){var sDisplay=$(nChildren[i]).css("display");if(sDisplay!="none"){_aoPrintHidden.push({"node":nChildren[i],"display":sDisplay});nChildren[i].style.display="none"}}}if(nParent.nodeName!="BODY"){fnPrintHideNodes(nParent)}}function fnGlue(clip,node,id,text){if(document.getElementById(id)){clip.glue(node,text)}else{setTimeout(function(){fnGlue(clip,node,id,text)},100)}}function fnGetTitle(){var sTitle;if(_oSettings.sTitle!==""){sTitle=_oSettings.sTitle}else{sTitle=document.getElementsByTagName('title')[0].innerHTML}if("\u00A1".toString().length<4){return sTitle.replace(/[^a-zA-Z0-9_\u00A1-\uFFFF\.,\-_ !\(\)]/g,"")}else{return sTitle.replace(/[^a-zA-Z0-9_\.,\-_ !\(\)]/g,"")}}function fnFindParentClass(n,sClass){if(n.className.match(sClass)||n.nodeName=="BODY"){return n}else{return fnFindParentClass(n.parentNode,sClass)}}function fnBoundData(sData,sBoundary,regex){if(sBoundary===""){return sData}else{return sBoundary+sData.replace(regex,"\\"+sBoundary)+sBoundary}}function fnHtmlDecode(sData){var aData=fnChunkData(sData,2048),n=document.createElement('div'),i,iLen,iIndex,sReturn="",sInner;for(i=0,iLen=aData.length;i<iLen;i++){iIndex=aData[i].lastIndexOf('&');if(iIndex!=-1&&aData[i].length>=8&&iIndex>aData[i].length-8){sInner=aData[i].substr(iIndex);aData[i]=aData[i].substr(0,iIndex)}n.innerHTML=aData[i];sReturn+=n.childNodes[0].nodeValue}return sReturn}function fnChunkData(sData,iSize){var asReturn=[];var iStrlen=sData.length;for(var i=0;i<iStrlen;i+=iSize){if(i+iSize<iStrlen){asReturn.push(sData.substring(i,i+iSize))}else{asReturn.push(sData.substring(i,iStrlen))}}return asReturn}function fnFlashSetText(clip,sData){var asData=fnChunkData(sData,8192);clip.clearText();for(var i=0,iLen=asData.length;i<iLen;i++){clip.appendText(asData[i])}}function fnGetDataTablesData(sSeperator,sBoundary){var i,iLen;var j,jLen;var sData='';sData=_oSettings.sPrintMessage.replace(/<br\/>/g,"\n");var sLoopData='';var sNewline=navigator.userAgent.match(/Windows/)?"\r\n":"\n";if(typeof sBoundary=="undefined"){sBoundary=""}var regex=new RegExp(sBoundary,"g");for(i=0,iLen=_DTSettings.aoColumns.length;i<iLen;i++){if(_oSettings.bIncHiddenColumns===true||_DTSettings.aoColumns[i].bVisible){sLoopData=_DTSettings.aoColumns[i].sTitle.replace(/\n/g," ").replace(/<.*?>/g,"");if(sLoopData.indexOf('&')!=-1){sLoopData=fnHtmlDecode(sLoopData)}sData+=fnBoundData(sLoopData,sBoundary,regex)+sSeperator}}sData=sData.slice(0,sSeperator.length*-1);sData+=sNewline;for(j=0,jLen=_DTSettings.aiDisplay.length;j<jLen;j++){for(i=0,iLen=_DTSettings.aoColumns.length;i<iLen;i++){if(_oSettings.bIncHiddenColumns===true||_DTSettings.aoColumns[i].bVisible){var mTypeData=_DTSettings.aoData[_DTSettings.aiDisplay[j]]._aData[i];if(typeof mTypeData=="string"){sLoopData=mTypeData.replace(/\n/g," ");sLoopData=sLoopData.replace(/<img.*?\s+alt\s*=\s*(?:"([^"]+)"|'([^']+)'|([^\s>]+)).*?>/gi,'$1$2$3')sLoopData=sLoopData.replace(/<.*?>/g,"")}else{sLoopData=mTypeData+""}sLoopData=sLoopData.replace(/^\s+/,'').replace(/\s+$/,'');if(sLoopData.indexOf('&')!=-1){sLoopData=fnHtmlDecode(sLoopData)}sData+=fnBoundData(sLoopData,sBoundary,regex)+sSeperator}}sData=sData.slice(0,sSeperator.length*-1);sData+=sNewline}sData.slice(0,-1);if(_oSettings.bIncFooter){for(i=0,iLen=_DTSettings.aoColumns.length;i<iLen;i++){if(_DTSettings.aoColumns[i].nTf!==null&&(_oSettings.bIncHiddenColumns===true||_DTSettings.aoColumns[i].bVisible)){sLoopData=_DTSettings.aoColumns[i].nTf.innerHTML.replace(/\n/g," ").replace(/<.*?>/g,"");if(sLoopData.indexOf('&')!=-1){sLoopData=fnHtmlDecode(sLoopData)}sData+=fnBoundData(sLoopData,sBoundary,regex)+sSeperator}}sData=sData.slice(0,sSeperator.length*-1)}_sLastData=sData;return sData}return _fnInit(oInit)}if(typeof $.fn.dataTable=="function"&&typeof $.fn.dataTableExt.sVersion!="undefined"){$.fn.dataTableExt.aoFeatures.push({"fnInit":function(oSettings){return new TableTools({"oDTSettings":oSettings})},"cFeature":"T","sFeature":"TableTools"})}else{alert("Warning: TableTools requires DataTables 1.5 or greater - "+"www.datatables.net/download")}})(jQuery);